<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<html>
<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" rel="stylesheet" />
    <link href="css/style.css" type="text/css" rel="stylesheet" />


</head>
<body>
    <div class="container">
        <div class="messaging">
            <div class="inbox_msg">
                
                <div class="mesgs">
                    <div class="msg_history" id="disscussion">
                        <div class="incoming_msg">
                            <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                            <div class="received_msg">
                                <div class="received_withd_msg">
                                    <p>
                                        Test which is a new approach to have all
                                        solutions
                                    </p>
                                    <span class="time_date"> 11:01 AM    |    June 9</span>
                                </div>
                            </div>
                        </div>
                        <div class="outgoing_msg">
                            <div class="sent_msg">
                                <p>
                                    Test which is a new approach to have all
                                    solutions
                                </p>
                                <span class="time_date"> 11:01 AM    |    June 9</span>
                            </div>
                        </div>
                        <div class="incoming_msg">
                            <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                            <div class="received_msg">
                                <div class="received_withd_msg">
                                    <p>Test, which is a new approach to have</p>
                                    <span class="time_date"> 11:01 AM    |    Yesterday</span>
                                </div>
                            </div>
                        </div>
                        <div class="outgoing_msg">
                            <div class="sent_msg">
                                <p>Apollo University, Delhi, India Test</p>
                                <span class="time_date"> 11:01 AM    |    Today</span>
                            </div>
                        </div>
                        <div class="outgoing_msg">
                            <div class="sent_msg">
                                <p>Тесттесттест</p>
                                <span class="time_date"> 12.00</span>
                            </div>
                        </div>
                        <div class="incoming_msg">
                            <div class="incoming_msg_img"> <img src="https://ptetutorials.com/images/user-profile.png" alt="sunil"> </div>
                            <div class="received_msg">
                                <div class="received_withd_msg">
                                    <p>
                                        We work directly with our designers and suppliers,
                                        and sell direct to you, which means quality, exclusive
                                        products, at a price anyone can afford.
                                    </p>
                                    <span class="time_date"> 11:01 AM    |    Today</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="type_msg">
                        <div class="input_msg_write">
                            <input type="text" class="write_msg" placeholder="Type a message" id="message" />
                            <button class="msg_send_btn" id="sendmessage" value="Send"><i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>
            </div>



        </div>
    </div>
    <script type="text/javascript" src="js/signalr.min.js"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            
            var messageInput = document.getElementById('message');
            // Get the user name and store it to prepend to messages.
            var name = prompt('Enter your name:', '');
           // document.getElementById('Sname').textContent = name;
            // Set initial focus to message input box.
            messageInput.focus();
            // Start the connection.
            var connection = new signalR.HubConnectionBuilder()
                .withUrl('/chat')
                .build();
            // Create a function that the hub can call to broadcast messages.
            connection.on('broadcastMessage', function ( message, name) {
                var today = new Date();
                // Html encode display name and message.
               // var encodedName = name;
                var encodedMsg = message;
                console.log(encodedMsg);
                console.log(name);       

                var currentTime = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
                // Add the message to the page.
                var sendMessage = document.createElement('div');
                var sendDiv = document.createElement('div');
                var sendText = document.createElement('p');
                var sendTime = document.createElement('span');
                sendTime.className = "time_date";
                sendDiv.className = "sent_msg";
                sendMessage.className = "outgoing_msg";
                sendText.innerHTML = encodedMsg;
                sendTime.innerHTML = currentTime;
                sendDiv.appendChild(sendText);
                sendDiv.appendChild(sendTime);
                sendMessage.appendChild(sendDiv);
               
                document.getElementById('disscussion').appendChild(sendMessage);
                console.log(encodedMsg);
            });
            // Transport fallback functionality is now built into start.
            connection.start()
                .then(function () {
                    console.log('connection started');

                    document.getElementById('sendmessage').addEventListener('click', function (event) {
                        // Call the Send method on the hub.
                        connection.invoke('send', name, messageInput.value);
                        // Clear text box and reset focus for next comment.
                        messageInput.value = '';
                        messageInput.focus();
                        event.preventDefault();
                    });
                })
                .catch(error => {
                    console.error(error.message);
                });
        });
    </script>
</body>
</html>








